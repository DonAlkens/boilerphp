@{{extends "vendor/shared/layout"}}
{{$product = ~product~}}
<div class="content-wrapper">
    <div class="row">
        <div class="col-12 grid-margin">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title mt-3 mb-4">Edit Product - #@{{$product->id}}</h2>

                    <div class="edit-product-form">
                        <ul class="nav nav-pills mb-2" id="pills-tab" role="tablist" style="border-bottom: 1px solid #F3F6F9;">
                            <li class="nav-item">
                                <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#product-information"
                                    role="tab" aria-controls="pills-home" aria-selected="true">
                                    <i class="mdi mdi-tshirt-crew"></i> Product Informations
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#product-images"
                                    role="tab" aria-controls="pills-profile" aria-selected="false"> 
                                    <i class="mdi mdi-image-multiple"></i> Images
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#product-variations"
                                    role="tab" aria-controls="pills-contact" aria-selected="false">
                                    <i class="mdi mdi-package-variant"></i> Variation
                                </a>
                            </li>
                            <!-- <li class="nav-item">
                                <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#product-shipping"
                                    role="tab" aria-controls="pills-contact" aria-selected="false">
                                    <i class="mdi mdi-truck"></i> <b>Shipping</b>
                                </a>
                            </li> -->
                            <li class="nav-item">
                                <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#product-settings"
                                    role="tab" aria-controls="pills-profile" aria-selected="false">
                                    <i class="mdi mdi-settings"></i> Settings
                                </a>
                            </li>
                        </ul>

                        <div class="tab-content" id="pills-tabContent">

                            <div class="tab-pane fade show active" id="product-information" role="tabpanel"
                                aria-labelledby="pills-home-tab">
                                <form action="/api/a/edit-product-information/@{{$product->id}}" edit="true" method="post" class="ajaxForm">
                                    <div>
                                        <div class="form-light-box mb-3">
                                            <div class="row">
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="Collection"><b>Collection</b></label>
                                                        <select api-options="/api/a/get-collections" api-change="/api/a/get-categories" 
                                                        api-selected="@{{$product->collection}}" api-result-target="#Category"
                                                        validation-message="Select a collection*"
                                                        class="form-control" validate-field="true" name="collection" id="Collection">
                                                            <option value="">**select product collection**</option>
                                                        </select>
                                                        <span class="text-danger">{{validation("collection")}}</span>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="Category"><b>Category</b></label>
                                                        <select class="form-control" api-options="/api/a/get-categories/@{{$product->collection}}" api-selected="@{{$product->category}}" 
                                                            api-change="/api/a/get-subcategories" api-result-target="#SubCategory" name="category" id="Category">
                                                        </select>
                                                        <span class="text-danger">{{validation("category")}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="SubCategory"><b>Sub Category</b></label>
                                                        <select class="form-control" api-options="/api/a/get-subcategories/@{{$product->category}}" api-selected="@{{$product->sub_category}}" 
                                                            name="sub_category" id="SubCategory" @{{($product->sub_category == 0) ? "disabled" : null}}>
                                                        </select>
                                                        <span class="text-danger">{{validation("sub_category")}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="form-light-box mb-3">
                                            <div class="form-group">
                                                <label for="Name"><b>Product Name <span>*</span></b></label>
                                                <input type="text" class="form-control" validation-message="Name is required*"
                                                validate-field="true" value="@{{$product->name}}"
                                                name="name" id="Name" placeholder="Enter Product Name">
                                                <span class="text-danger">{{validation("name")}}</span>
                                            </div>

                                            <div class="row mt-2">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="Color"><b>Color <span>*</span></b></label>
                                                        <input type="text" class="form-control" validate-field="true" 
                                                        validation-message="Color is required*" value="@{{$product->color}}"
                                                        name="color" id="Color" placeholder="Enter Product Color">
                                                        <span class="text-danger">{{validation("color")}}</span>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="Brand"><b>Brand <span>*</span></b></label>
                                                        <input type="text" class="form-control" validation-message="Brand is required*"
                                                        validate-field="true" value="@{{$product->brand}}" name="brand" id="Brand">
                                                        <span class="text-danger">{{validation("brand")}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="form-light-box mb-3">
                                            <div class="row">
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="price"><b>Price <span>*</span></b></label>
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <span class="input-group-text">NGN</span>
                                                            </div>
                                                            <!-- <div class="input-group-prepend">
                                                                <span class="input-group-text">0.00</span>
                                                            </div> -->
                                                            <input type="text" class="form-control" validate-field="true" 
                                                            value="@{{$product->price}}" validation-message="Price is required*"
                                                            name="price" id="Price" placeholder="0">
                                                            <span class="text-danger">{{validation("price")}}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="Discount"><b>Sales Discount (%) </b></label>
                                                        <div class="input-group">
                                                            <input type="number" max="100" min="0" class="form-control" name="discount" id="Discount" value="@{{$product->discount}}">
                                                            <span class="text-danger">{{validation("discount")}}</span>
                                                            <div class="input-group-append">
                                                                <span class="input-group-text">%</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="DiscountPrice"><b>Sales/Discount (Price) </b></label>
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <span class="input-group-text">NGN</span>
                                                            </div>
                                                            <!-- <div class="input-group-prepend">
                                                                <span class="input-group-text">0.00</span>
                                                            </div> -->
                                                            <input class="form-control" validate-field="true"
                                                            validation-message="Discount price is required <small>(use 0 if no discount is applied)</small>*"
                                                            name="discount_price" value="@{{$product->discount_price}}" id="DiscountPrice"/>
                                                            <span class="text-danger">{{validation("discount_price")}}</span>
                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="Quantity"><b>Quantity <span>*</span></b></label>
                                                        <input type="number" min="0" class="form-control" validate-field="true"
                                                        validation-message="Quantity is required*"
                                                        name="quantity" id="Quantity" value="@{{$product->quantity}}"/>
                                                        <span class="text-danger">{{validation("quantity")}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-light-box mb-3">
                                            <div class="form-group">
                                                <label for="Name"><b>Product Description <span>*</span></b></label>
                                                <textarea class="form-control" name="description" id="Description">@{{$product->description}}</textarea>
                                            </div>
                                        </div>

                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between flex-row-reverse">
                                                <button type="submit" class="btn btn-primary btn-fw">Save Changes</button>
                                                <a href="/a/products" class="btn btn-light btn-fw">Cancel</a>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            
                            <div class="tab-pane fade" id="product-images" role="tabpanel"
                                aria-labelledby="pills-profile-tab">
                                <form action="/api/a/edit-product-images/@{{$product->id}}" edit="true" method="post" class="ajaxForm" enctype="multipart/form-data">
                                    <div>
                                        <div class="form-light-box mb-3">
                                            <div class="form-group">
                                                <label for="Brand"><b>Product Image <span>*</span></b></label>
                                                <div class="text-center">
                                                    <div class="image-box">
                                                        
                                                        <div class="thumbnail" id="mainImage">
                                                            <img src="/src/images/@{{$product->images()->main}}" alt="">
                                                        </div>
                                                        <div class="change-action">
                                                            <label for="Image" class="btn btn-sm btn-inverse-success">
                                                                <i class="mdi mdi-image"></i> Change image
                                                                <input type="file" class="hide" name="image" id="Image">
                                                            </label>
                                                        </div>
        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="form-light-box mb-3">
                                            <div class="form-group">
                                                <label for=""><b>Gallery</b> <small>(you can add other samples images for product here)</small></label>
                                                <div class="image-box" id="GalleryBox">
                                                    @if($product->images()->gallery)
                                                        {{$pictures = explode(",", $product->images()->gallery)}}
        
                                                        {{$index = 0}}
                                                        @foreach($pictures as $picture)
                                                            <div class="thumbnail small" api-image="@{{$index}}">
                                                                <img src="/src/images/@{{$picture}}" alt="">
                                                                <button type="button" api-image-url="src/images/@{{$picture}}" api-image-id="@{{$index}}" 
                                                                    api-image-remover="/api/a/remove-images/@{{$product->id}}" 
                                                                    class="btn btn-icon btn-inverse-danger btn-rounded">x</button>
                                                            </div>
                                                            {{$index++}}
                                                        @endforeach
                                                    @endif
                                                </div>
                                            </div>
                                            <div class="form-group text-right">
                                                <label for="Gallery" class="btn btn-inverse-success btn-sm">
                                                    <i class="mdi mdi-plus-circle-outline"></i> Add image
                                                    <input type="file" class="hide" name="gallery" id="Gallery" multiple>
                                                </label>
                                            </div>
                                        </div>
    
                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between flex-row-reverse">
                                                <button type="submit" class="btn btn-primary btn-fw">Save Changes</button>
                                                <a href="/a/products" class="btn btn-light btn-fw">Cancel</a>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <div class="tab-pane fade" id="product-variations" role="tabpanel"
                                aria-labelledby="pills-profile-tab">
                                <form action="/api/a/edit-product-variations/@{{$product->id}}" edit="true" method="post" class="ajaxForm">
                                    <div>
                                        <div class="form-light-box mb-3">
                                            <label class="mb-2"><b>Variation Options</b></label>
                                            <div class="row" id="skeletonForm">
                                                <div class="col-md-12 hide" id="skeleton">
                                                    <div class="col-md-12">
                                                        <div class="row">
                                                            <div class="col-md-3 p-1 var_type">
                                                                <div class="form-group">
                                                                    <select api-options="/api/a/get-variations" class="form-control" name="variations[]" id="variations">
                                                                        <option value="">**select a variation**</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-8 p-1">
                                                                <div class="form-group">
                                                                    <textarea name="variation_options[]" class="form-control var_name" 
                                                                    api-variation-creator="" placeholder="options" onblur="handleblur2(this);"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-1 rmVar hide p-1" onclick="remover2(this);">
                                                                <button type="button" class="btn btn-danger btn-sm"> <i class="mdi mdi-delete-forever"></i> </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
    
                                                {{$variations = $product->variations()}}
                                                @if($variations != null)

                                                    @func var_names($var)

                                                        $names = $var
                                                                ->where(["product" => $var->product, "variation" => $var->variation])
                                                                ->all();
                                                        $var_names = "";
                                                        if($names != null) {
                                                            foreach($names as $name) {
                                                                $var_names .= $name->name .", ";
                                                            }
                                                        }

                                                        return trim($var_names, ", ");
                                                    @endfunc
    
                                                    @foreach($variations as $variation)
                                                        <div class="col-md-12" id="variation@{{$variation->id}}">
                                                            <div class="col-md-12">
                                                                <div class="row">
                                                                    <div class="col-md-3 p-1 var_type">
                                                                        <div class="form-group">
                                                                            <select api-options="/api/a/get-variations" api-selected="@{{$variation->variation}}" 
                                                                                class="form-control variations" name="variations[]">
                                                                                <option value="">**select a variation**</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-8 p-1">
                                                                        <div class="form-group">
                                                                            <textarea name="variation_options[]" class="form-control var_name" 
                                                                            api-variation-creator="" placeholder="options" onblur="handleblur2(this);">@{{var_names($variation)}}</textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-1 rmVar p-1" 
                                                                        api-variation-remover="/api/a/remove-variations/@{{$variation->product}}/@{{$variation->variation}}" 
                                                                        object-item="#variation@{{$variation->id}}">
                                                                        <!-- onclick="remover2(this);" -->
                                                                        <button type="button" class="btn btn-danger btn-sm"> <i class="mdi mdi-delete-forever"></i> </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    @endfor
    
                                                @endif
            
                                            </div>
                                            <div class="col-md-12 mt-2">
                                                <div class="row">
                                                    <div class="text-left">
                                                        <div class="form-group">
                                                            <button type="button" class="btn btn-sm btn-inverse-info" id="addSkeletonBtn2">
                                                                + add more
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
    
                                        <div class="form-light-box mb-3" api-variation-list="">
                                            @if($variations != null)
                                                {{$index = 0}}
                                                @if($product->options())
                                                    {{$options = $product->options()}}
                                                    @foreach($options as $option)
                                                        <div class="col-md-12">
                                                            <div class="row">
                                                                <input type="hidden" name="variants_ids[]" value="@{{$option->id}}">
                                                                <div class="col-md-2 p-1">
                                                                    <div class="form-group">
                                                                        <small>Variant</small><br>
                                                                        <span class="text-primary">
                                                                            <b>@{{$option->variant}}</b>
                                                                            <input type="hidden" value="@{{$option->variant}}" name="variants[]">
                                                                            <!-- @{{str_replace(' ', '',$option->variant)}} -->
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 p-1">
                                                                    <div class="form-group">
                                                                        <div class="input-group">
                                                                            <div class="input-group-prepend">
                                                                                <span class="input-group-text">NGN</span>
                                                                            </div>
                                                                            <input name="variant_price[]" 
                                                                            validate-field="true" validation-message="<small>Enter the price for this item*</small>"
                                                                            step-field-required="true" step-validation-message="<small>Enter the price for this item*</small>"
                                                                            value="@{{$option->price}}" class="form-control" placeholder="Price">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 p-1">
                                                                    <div class="form-group">
                                                                        <input type="number" name="variant_qty[]" validate-field="true" 
                                                                        validation-message="<small>Enter the quantity for this item*</small>"
                                                                        step-field-required="true" step-validation-message="<small>Enter the quantity for this item*</small>"
                                                                        value="@{{$option->quantity}}" class="form-control" min="0" placeholder="quantity">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 p-1">
                                                                    <div class="form-group">
                                                                        {{$img = explode(",", $option->images)}}
                                                                        <small>@{{(count($img) > 1) ? count($img)." images" : count($img)." image"}} </small>
                                                                        <label for="Item@{{$index}}Images" class="btn btn-sm btn-inverse-success">
                                                                            + add images
                                                                            <input type="file" class="hide" id="Item@{{$index}}Images" name="variant_@{{$index}}_images[]" multiple >
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 p-1">
                                                                    <div class="form-group">
                                                                        <div class="custom-control custom-switch">
                                                                            <input name="variant_stock[]" type="checkbox"  class="custom-control-input" id="Item@{{$index}}InStock" @{{($option->in_stock == "1") ? "checked" : null}}>
                                                                            <label class="custom-control-label ln-16" for="Item@{{$index}}InStock">In Stock</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {{$index++}}
                                                    @endforeach
                                                @endif
                                            @endif
                                        </div>

                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between flex-row-reverse">
                                                <button type="submit" class="btn btn-primary btn-fw">Save Changes</button>
                                                <a href="/a/products" class="btn btn-light btn-fw">Cancel</a>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <div class="tab-pane fade" id="product-settings" role="tabpanel"
                                aria-labelledby="pills-contact-tab">
                                <form action="/api/a/edit-product-settings/@{{$product->id}}" edit="true" method="post" class="ajaxForm">
                                    <div>
                                        <div class="form-light-box mb-3">
                                            <label class="mb-4"><b>Products Settings</b></label>
                                            
                                            <div class="row mb-2">
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <div class="custom-control custom-switch">
                                                            <input name="featured" type="checkbox" class="custom-control-input" id="featured" @{{ ($product->settings()->featured == 1) ? "checked" : null }}>
                                                            <label class="custom-control-label ln-16" for="featured">Set as featured product</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <div class="custom-control custom-switch">
                                                            <input name="out_of_stock" type="checkbox" class="custom-control-input" id="oufOfStock"  @{{ ($product->settings()->out_of_stock == 1) ? "checked" : null }}>
                                                            <label class="custom-control-label ln-16" for="oufOfStock">Out Of Stock</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
    
                                            <!-- <div class="row mb-2">
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="customSwitches" checked>
                                                            <label class="custom-control-label ln-16" for="customSwitches">Track Product Inventory</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="customSwitches">
                                                            <label class="custom-control-label ln-16" for="customSwitches">Out Of Stock</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div> -->
                                        </div>

                                        <div class="form-light-box mb-3">
                                            <label class="mb-2"><b>Search Keywords*</b></label>
                                            <div class="form-group">
                                                <textarea name="search_keywords" validate-field="true"
                                                 cols="30" rows="6" class="form-control" placeholder="ex. blue trousers, shirts, jeans..">@{{$product->settings()->search_keywords}}</textarea>
                                            </div>
                                        </div>

                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between flex-row-reverse">
                                                <button type="submit" class="btn btn-primary btn-fw">Save Changes</button>
                                                <a href="/a/products" class="btn btn-light btn-fw">Cancel</a>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>